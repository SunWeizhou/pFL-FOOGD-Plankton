# pFL-FOOGD 实验分析总结

## 实验概述

基于对 `experiments/` 文件夹的分析，共发现 **4个完整实验**，所有实验均启用了FOOGD模块，使用不同的Alpha值进行数据异质性控制。

### 实验配置
- **模型架构**: DenseNet-169
- **客户端数量**: 5
- **通信轮次**: 50
- **本地训练轮次**: 1
- **批次大小**: 64
- **FOOGD模块**: 全部启用

## 实验结果总结

### 1. 最佳准确率对比

| Alpha值 | 最佳准确率 | 最终测试准确率 | 提升幅度 |
|---------|------------|----------------|----------|
| 0.1     | 0.6078     | 0.1283         | +0.4795  |
| 0.5     | 0.5940     | 0.1834         | +0.4106  |
| 1.0     | 0.6477     | 0.2508         | +0.3969  |
| 10.0    | 0.6795     | 0.3294         | +0.3501  |

**关键发现**:
- **Alpha=10.0** 获得最高最佳准确率 (0.6795)
- 随着Alpha值增大，最终测试准确率逐渐提高
- 所有实验的最佳准确率都显著高于最终准确率，表明存在过拟合或训练不稳定的问题

### 2. OOD检测性能

#### Near-OOD检测 (AUROC)
- **Alpha=0.1**: 0.5333
- **Alpha=0.5**: 0.5070
- **Alpha=1.0**: 0.5126
- **Alpha=10.0**: 0.4632

#### Far-OOD检测 (AUROC)
- **Alpha=0.1**: 0.6165
- **Alpha=0.5**: 0.6266
- **Alpha=1.0**: 0.4068
- **Alpha=10.0**: 0.5938

**关键发现**:
- Far-OOD检测性能普遍优于Near-OOD检测
- Alpha=1.0在Far-OOD检测上表现异常低 (0.4068)
- Alpha=0.5在Far-OOD检测上表现最佳 (0.6266)

### 3. 训练动态分析

#### 训练损失
- 所有实验的训练损失在前10轮快速下降
- 后续训练损失趋于平稳，在5.9-6.2之间波动
- 没有明显的过拟合迹象（训练损失持续下降）

#### 测试准确率
- 测试准确率在训练过程中波动较大
- 最佳准确率通常出现在训练中期（第15-25轮）
- 后期测试准确率下降，可能与学习率调度或模型复杂度有关

### 4. 个人化增益分析
- 个人化增益（Head_P - Head_G）在训练过程中波动
- 部分轮次个人化增益为负值，表明通用头在某些情况下优于个人头
- 平均个人化增益约为0.01-0.05，表明个人化效果有限

## 可视化图表

已生成以下可视化图表：

1. **`training_curves.png`** - 训练损失、测试损失、测试准确率和个人化增益曲线
2. **`ood_performance.png`** - Near/Far-OOD检测性能和IN-C鲁棒性
3. **`comparison_summary.png`** - 不同Alpha值下的综合性能对比

## 问题与建议

### 发现的问题
1. **训练不稳定**: 测试准确率波动较大，最佳准确率与最终准确率差距显著
2. **过拟合风险**: 最佳准确率远高于最终准确率
3. **个人化效果有限**: 个人化增益较小
4. **OOD检测性能中等**: AUROC在0.5-0.65之间，有提升空间

### 改进建议
1. **调整学习率策略**: 尝试余弦退火或学习率预热
2. **增加正则化**: 添加Dropout或权重衰减
3. **延长训练**: 增加通信轮次或本地训练轮次
4. **数据增强**: 增强数据多样性
5. **模型架构调整**: 尝试不同的骨干网络或FOOGD参数

## 后续实验建议

1. **补充FOOGD禁用实验**: 当前只有FOOGD启用的实验，需要补充禁用FOOGD的对照实验
2. **扩展Alpha范围**: 测试更多Alpha值（如0.01, 0.05, 100等）
3. **客户端数量变化**: 测试不同客户端数量的影响
4. **模型架构对比**: 对比DenseNet-121和DenseNet-169
5. **超参数调优**: 系统性的超参数搜索

## 文件位置

- 可视化脚本: `visualize_experiments.py`
- 生成图表: `visualizations/` 文件夹
- 实验数据: `experiments/` 文件夹
- 本总结: `experiment_analysis_summary.md`

## 使用说明

重新生成可视化图表:
```bash
python visualize_experiments.py
```

查看特定实验的详细配置:
```bash
cat experiments/alpha0.1_with_foogd/experiment_20251206_132415/config.json
```

查看训练历史:
```bash
cat experiments/alpha0.1_with_foogd/experiment_20251206_132415/training_history.json | head -50
```